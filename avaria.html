<div class="page-content fade-in">
    <div class="form-section">
        <h2>‚ö†Ô∏è Comunica√ß√£o de Avaria</h2>
        
        <div class="comunicado-header">
            <p><strong>AO:</strong> Chefe da SSTRAN</p>
            <p><strong>ASSUNTO:</strong> Informa√ß√£o de Viatura</p>
        </div>
        
        <form id="avariaForm">
            <div class="form-grid">
                <div class="form-row">
                    <div class="form-group">
                        <label for="avariaData">Data da Verifica√ß√£o</label>
                        <input type="date" id="avariaData" required>
                    </div>
                    <div class="form-group">
                        <label for="avariaTipoViatura">Tipo de Viatura</label>
                        <input type="text" id="avariaTipoViatura" required placeholder="Ex: XR300, Parati, Fox, Amarok...">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="avariaPlaca">Placa</label>
                        <input type="text" id="avariaPlaca" required placeholder="ABC-1234" class="placa-mask">
                    </div>
                    <div class="form-group">
                        <label for="avariaKmAtual">KM Atual</label>
                        <input type="number" id="avariaKmAtual" required min="0" step="1" placeholder="Quilometragem atual">
                    </div>
                    <div class="form-group">
                        <label for="avariaPatrimonio">Patrim√¥nio</label>
                        <input type="text" id="avariaPatrimonio" required placeholder="N√∫mero do patrim√¥nio">
                    </div>
                </div>

                <div class="form-group">
                    <label>üîç Altera√ß√µes/Problemas Identificados:</label>
                    <div class="avaria-list">
                        <div class="avaria-item">
                            <input type="text" class="avaria-descricao" placeholder="Descreva o problema ou altera√ß√£o..." required>
                            <button type="button" class="btn-remove-avaria" onclick="removerAvaria(this)">‚úï</button>
                        </div>
                    </div>
                    <button type="button" class="btn-secondary" onclick="adicionarAvaria()" style="margin-top: 0.5rem;">
                        + Adicionar Outro Problema
                    </button>
                </div>

                <!-- NOVO CAMPO: Observa√ß√µes/Relato do Motorista -->
                <div class="form-group full-width">
                    <label for="avariaObservacoes">üìù Observa√ß√µes / Relato do Motorista</label>
                    <textarea id="avariaObservacoes" placeholder="Descreva detalhadamente o ocorrido, condi√ß√µes de uso, sintomas observados, ou qualquer informa√ß√£o adicional relevante para a an√°lise da avaria..." rows="4"></textarea>
                    <small style="color: #666; margin-top: 0.25rem; display: block;">
                        Este campo √© opcional, mas recomendado para fornecer contexto adicional sobre os problemas identificados.
                    </small>
                </div>

                <div class="assinatura-section">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="avariaAssinatura">Assinatura</label>
                            <input type="text" id="avariaAssinatura" required placeholder="Seu nome de guerra para assinatura">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="avariaGrad">Gradua√ß√£o</label>
                            <input type="text" id="avariaGrad" readonly>
                        </div>
                        <div class="form-group">
                            <label for="avariaMatricula">Matr√≠cula</label>
                            <input type="text" id="avariaMatricula" readonly>
                        </div>
                        <div class="form-group">
                            <label for="avariaNome">Nome Completo</label>
                            <input type="text" id="avariaNome" readonly>
                        </div>
                    </div>
                </div>
            </div>
            
            <button type="submit" class="btn-primary">
                <span class="btn-icon">üìã</span>
                Enviar Comunica√ß√£o de Avaria
            </button>
        </form>
    </div>

    <div class="form-section">
        <h2>üìã Comunica√ß√µes de Avaria Recentes</h2>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Viatura</th>
                        <th>Problemas</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="historicoAvarias">
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 2rem;">
                            <div style="color: #6c757d;">
                                <span style="font-size: 3rem;">‚ö†Ô∏è</span>
                                <p>Nenhuma comunica√ß√£o de avaria</p>
                                <small>As comunica√ß√µes aparecer√£o aqui</small>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // Fun√ß√µes globais para os bot√µes
    function adicionarAvaria() {
        if (window.frotaSystem) {
            window.frotaSystem.adicionarAvaria();
        }
    }

    function removerAvaria(button) {
        if (window.frotaSystem) {
            window.frotaSystem.removerAvaria(button);
        }
    }

    // NOVA FUN√á√ÉO: Preencher automaticamente os campos do usu√°rio logado
    document.addEventListener('DOMContentLoaded', function() {
        // Preencher data atual
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('avariaData').value = today;
        
        // Tentar preencher dados do usu√°rio se dispon√≠vel
        if (window.auth && window.auth.getCurrentUser) {
            const user = window.auth.getCurrentUser();
            if (user) {
                document.getElementById('avariaGrad').value = user.graduacao || '';
                document.getElementById('avariaMatricula').value = user.matricula || '';
                document.getElementById('avariaNome').value = user.nome || '';
                document.getElementById('avariaAssinatura').value = user.nomeGuerra || user.nome || '';
            }
        }
    });
</script>